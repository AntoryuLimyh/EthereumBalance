<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script> <!-- use this as web3  -->
    
    base_url = "https://mainnet.infura.io/v3/"

    <!-- <script type="text/javascript" src="https://raw.githubusercontent.com/ChainSafe/web3.js/1.x/dist/web3.min.js"></script> -->
    <script type="text/javascript">
        window.addEventListener('load', function () {
            if (typeof web3 !== 'undefined') {
                console.log('Web3 Detected! ' + web3.currentProvider.constructor.name)
               window.web3 = new Web3(new Web3.providers.HttpProvider(base_url  + ${{ secrets.INFURAAPI}}));
            } else {
                console.log('No Web3 Detected... using HTTP Provider')
                window.web3 = new Web3(new Web3.providers.HttpProvider(base_url  + "${{ secrets.INFURAAPI}}"));
            }
        });
    </script>

    <title>Bal of etherscan.io</title>
</head>
<body style="background-color:#F6F5F1; flex: 1; display: grid; justify-content: center">
    <br><br><br>
    <h1> ERC20 Token Balance (main)</h1>
    <p> https://etherscan.io/tokentxns </p>
    <p>(FILTERED BY TOKEN HOLDER)</p>
    <label for="account"><strong>Account :</strong></label>
    <input type="text" id="account" size="80" oninput="onAddressChange()" value="">
    <p>(Profile Summary > Contract)</p>
    <label for="token"><strong>Token :</strong></label>
    <input type="text" id="token" size="80" oninput="onAddressChange()" value="">
    <p>(Profile Summary > Decimal)</p>
    <label for="Decimal"><strong>Decimal :</strong></label>
    <input type="text" id="Decimal" size="80" oninput="onAddressChange()" value="18"><br><br>
    
  
    <button class="gettoken">Token</button><br><br>
    <!-- <button type="submit" class="gettoken">Token</button> -->
   
    <h2>Account: <span id = "acctdetails"></span></h2><br>
    <h2>Balance: <span id = "tknbalance"></span> <span id = "tknsymbol"></span></h2>
   
<script>

const token = document.querySelector('.gettoken');     

//Detect on Input Change
function onAddressChange(e) {


//Call function bal where it goes through the ABI
token.addEventListener('click', () => {
   bal();
   
 });
   

     window.ethereum
     ethereum.enable()
     web3 = new Web3(web3.currentProvider)
 
    //Get the acct address from the input change
    let walletAddress = document.getElementById('account').value;
    
    //Display it back into the html
    const acctdetails = document.getElementById("acctdetails");
    acctdetails.innerHTML = document.getElementById('account').value;

    //Get the token address from the input change
    let tokenAddress = document.getElementById('token').value;

    //Get the decimal place of the token
    let dec = document.querySelector('#Decimal').value
      console.log(dec)

   

    console.log(tokenAddress ,walletAddress )

     // The minimum ABI to get ERC20 Token balance
     let ABI = [{"inputs": [],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "owner","type": "address"},{"indexed": true,"internalType": "address","name": "spender","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Approval","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "from","type": "address"},{"indexed": true,"internalType": "address","name": "to","type": "address"       },
               {
                 "indexed": false,
                 "internalType": "uint256",
                 "name": "value",
                 "type": "uint256"
               }
             ],
             "name": "Transfer",
             "type": "event"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "owner",
                 "type": "address"
               },
               {
                 "internalType": "address",
                 "name": "spender",
                 "type": "address"
               }
             ],
             "name": "allowance",
             "outputs": [
               {
                 "internalType": "uint256",
                 "name": "",
                 "type": "uint256"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "spender",
                 "type": "address"
               },
               {
                 "internalType": "uint256",
                 "name": "amount",
                 "type": "uint256"
               }
             ],
             "name": "approve",
             "outputs": [
               {
                 "internalType": "bool",
                 "name": "",
                 "type": "bool"
               }
             ],
             "stateMutability": "nonpayable",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "account",
                 "type": "address"
               }
             ],
             "name": "balanceOf",
             "outputs": [
               {
                 "internalType": "uint256",
                 "name": "",
                 "type": "uint256"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [],
             "name": "decimals",
             "outputs": [
               {
                 "internalType": "uint8",
                 "name": "",
                 "type": "uint8"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "spender",
                 "type": "address"
               },
               {
                 "internalType": "uint256",
                 "name": "subtractedValue",
                 "type": "uint256"
               }
             ],
             "name": "decreaseAllowance",
             "outputs": [
               {
                 "internalType": "bool",
                 "name": "",
                 "type": "bool"
               }
             ],
             "stateMutability": "nonpayable",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "spender",
                 "type": "address"
               },
               {
                 "internalType": "uint256",
                 "name": "addedValue",
                 "type": "uint256"
               }
             ],
             "name": "increaseAllowance",
             "outputs": [
               {
                 "internalType": "bool",
                 "name": "",
                 "type": "bool"
               }
             ],
             "stateMutability": "nonpayable",
             "type": "function"
           },
           {
             "inputs": [],
             "name": "name",
             "outputs": [
               {
                 "internalType": "string",
                 "name": "",
                 "type": "string"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [],
             "name": "symbol",
             "outputs": [
               {
                 "internalType": "string",
                 "name": "",
                 "type": "string"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [],
             "name": "totalSupply",
             "outputs": [
               {
                 "internalType": "uint256",
                 "name": "",
                 "type": "uint256"
               }
             ],
             "stateMutability": "view",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "recipient",
                 "type": "address"
               },
               {
                 "internalType": "uint256",
                 "name": "amount",
                 "type": "uint256"
               }
             ],
             "name": "transfer",
             "outputs": [
               {
                 "internalType": "bool",
                 "name": "",
                 "type": "bool"
               }
             ],
             "stateMutability": "nonpayable",
             "type": "function"
           },
           {
             "inputs": [
               {
                 "internalType": "address",
                 "name": "sender",
                 "type": "address"
               },
               {
                 "internalType": "address",
                 "name": "recipient",
                 "type": "address"
               },
               {
                 "internalType": "uint256",
                 "name": "amount",
                 "type": "uint256"
               }
             ],
             "name": "transferFrom",
             "outputs": [
               {
                 "internalType": "bool",
                 "name": "",
                 "type": "bool"
               }
             ],
             "stateMutability": "nonpayable",
             "type": "function"
           }
         ]

     let contract = new web3.eth.Contract(ABI,tokenAddress);
     const tokenButton = document.querySelector('.gettoken')
     tokenButton.addEventListener('click', bal);
                
       function bal() {
            contract.methods.balanceOf(walletAddress).call().then(function(result) {return result/(10**dec)}) 
            .then(
              function(result) {
               const tknbal = document.getElementById("tknbalance");
               tknbal.innerHTML = `${result.toLocaleString()}` ;
               console.log(result) 
              
              contract.methods.symbol().call().then(function(sym) {return sym})
              .then(
              function(sym) {
              const tknsym = document.getElementById("tknsymbol");
              tknsym.innerHTML = sym ;
              console.log(sym) })            
             
            }
            )};

          }

</script>
</body>
</html>
